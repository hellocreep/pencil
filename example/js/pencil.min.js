!function(a){function b(a){var b=a||"canvas",c=document.getElementById(b),a=c.getContext("2d");this.el=c,this.paper=a,this.started=!1,this.trace=[],this.init()}b.prototype.init=function(){var a,b=this,c=["touchstart","touchmove","touchend"],d=["mousedown","mousemove","mouseup"];"ontouchstart"in window?(a=c,b.isTouch=!0):(a=d,b.isTouch=!1),this.el.addEventListener(a[0],function(a){b.start(a)},!1),this.el.addEventListener(a[1],function(a){a.preventDefault(),b.draw(a)},!1),this.el.addEventListener(a[2],function(a){b.stop(a)},!1)},b.prototype.start=function(a){this.started=!0,this.paper.beginPath();var b=this.isTouch?a.touches[0].pageX:a.offsetX,c=this.isTouch?a.touches[0].pageY:a.offsetY;this.paper.moveTo(b,c)},b.prototype.stop=function(){this.started=!1,this.trace.push("stop"),this.paper.closePath()},b.prototype.draw=function(a){if(this.started){var b=this.isTouch?a.touches[0].pageX:a.offsetX,c=this.isTouch?a.touches[0].pageY:a.offsetY;this.trace.push({x:b,y:c}),this.paper.lineTo(b,c),this.paper.stroke()}},b.prototype.clear=function(){this.paper.clearRect(0,0,this.paper.canvas.width,this.paper.canvas.height)},b.prototype._draw=function(){var a=this,b=0,c=a.trace.length;this.paper.beginPath();var d=function(){var e=a.trace[b];return"stop"===e?(a.paper.closePath(),cancelAnimationFrame(d),a.trace=a.trace.splice(b+1),void a._draw()):b>=c?void cancelAnimationFrame(d):(a.paper.lineTo(e.x,e.y),a.paper.stroke(),b++,void requestAnimationFrame(d))};requestAnimationFrame(d)},b.prototype.play=function(){this.clear(),this._draw()},b.DEFAULTS={paper:"canvas"},a.Pencil=b}(window);